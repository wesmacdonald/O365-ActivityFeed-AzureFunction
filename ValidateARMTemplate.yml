name: Validate ARM Template Pipeline

pool:
  vmImage: 'windows-latest'

stages:
  - stage: ARMCI
    jobs:
    - job: ARMTesting
      steps:
        - pwsh: mkdir "$(System.DefaultWorkingDirectory)\results"
          displayName: Create results folder

        - task: RunARMTTKTests@1
          displayName: Run ARM TTK tests 
          name: TTKtests
          inputs:
            templatelocation: '$(System.DefaultWorkingDirectory)\scripts'
            resultLocation: '$(System.DefaultWorkingDirectory)\results'

        - task: PublishTestResults@2
          displayName: Publish test restults
          name: PublishResults
          inputs:
            testResultsFormat: 'NUnit'
            testResultsFiles: '$(System.DefaultWorkingDirectory)\results\*-armttk.xml'
          condition: always()
